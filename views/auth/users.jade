extends ../layout

block page-header
    = title

block main-content
    div#response
    table.normal
        thead
            tr
                th User Id
                th Display Name
                th Name
                th Emails
                th Roles
                th Actions
        if users.length > 0
            tbody
                - each user in users
                  tr
                    td.user-id= user.userId
                    td.display-name= user.displayName
                    td.name= user.name.givenName + ' ' + user.name.familyName
                    td.email= user.emails[0].value
                        if user.emails.length > 1
                            div and #{user.emails.length - 1} more
                    td.roles
                        span tbd
                    td.actions
                        a.delete(href='/admin/user/#{user._id}') Delete
        else
            tbody
                tr: td(colspan=6) There are no current users.


append scripts
    script
        $(function () {
            $('a.delete').click(function () {
                var link = $(this);
                $.ajax(link.attr('href'), { type: 'DELETE'})
                    .done(function (data) {
                        if (data.success) {
                            link.closest('tr').remove();
                            $('#response').html($('<div>').addClass('alert-message success').text('User has been deleted.'));
                        } else {
                            $('#response').html($('<div>').addClass('alert-message error').text('Could not delete user.'));
                        }
                    });
                return false;
            });
        });